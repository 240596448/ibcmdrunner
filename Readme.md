
# ibcmdrunner

## Библиотека для упрощения работы с утилитами ibcmd и ibsrv из oscript.

Позволяет выполнять операции с информационной базой в стиле [v8runner](https://github.com/oscript-library/v8runner).

Пример работы:

```bsl

УправлениеИБ = Новый УправлениеИБ;
ВременныйКаталог = ОбъединитьПути(КаталогВременныхФайлов(), "tmp_db");
УправлениеИБ.УстановитьПараметрыФайловойИБ(ВременныйКаталог);
ПутьКФайлуКонфигурации = "c:\tmp\1c.cf";
УправлениеИБ.СоздатьИБИзФайлаКонфигурации(ПутьКФайлуКонфигурации);
```

```bsl

КонфигФайл = Новый КонфигурационныйФайлАС;
// Задаем параметры автономного сервера - IP-адрес, порт (по умолчанию 8314), имя сервера
КонфигФайл.ПараметрыСервера("127.0.0.1", , "MyFirstServer");
// Задаем параметры информационной базы, к которой подключаемся -
// путь, имя пользователя, пароль
КонфигФайл.ПараметрыФайловойБД("d:\1c_Bases\MyBase", "user", "123");
// Создаем конфигурационный файл c:\tmp\my-config.yml в формате YAML 
КонфигФайл.СоздатьКонфигурационныйФайл("c:\tmp\my-config.yml");
```

## Публичный интерфейс

### Класс УправлениеИБ

#### Путь к приложению

```bsl
// Устанавливает и возвращает путь к файлу приложения
// Параметры:
//  Путь - Строка - путь к файлу приложения
// Возвращаемое значение:
//   Строка - текущий путь к приложению
```

#### УстановитьПараметрыСервернойИБ

```bsl
// Установить параметры запуска для клиент-серверной информационной базы
// Параметры:
//  ТипСУБД - Строка - Тип СУБД. Допускаются значения
//          MSSQLServer - Microsoft SQL Server;
//        	PostgreSQL - PostgreSQL;
//        	IBMDB2 - IBM DB2;
//        	OracleDatabase - Oracle Database.
//        
//  СерверСУБД - строка - Имя сервера СУБД;
//  ИмяБД - Строка - Имя базы данных в СУБД;
//  ПользовательБД - Строка - Имя пользователя СУБД;
//  ПарольБД - Строка - Пароль пользователя в БД;
```

#### УстановитьПараметрыФайловойИБ

```bsl
// Установить параметры файловой информационной базы.
// Все команды ibcmd будут учитывать этот параметр.
//
// Параметры:
//   ПутьРабочийКаталог - Строка - Путь к рабочему каталогу.
```

#### УстановитьКонфигурационныйФайл

```bsl
// Установить конфигурационный файл автономного сервера 
// Параметры:
//  ИмяФайла - Строка - Полный путь к файлу конфигурации автономного сервера (yml);
```

#### УстановитьПараметрыАвторизацииИБ

```bsl
// Установить параметры авторизации информационной базы
// Параметры:
//  ПользовательИБ - Строка - имя пользователя информационной базы
//  ПарольИБ - Строка - пароль пользователя информационной базы
```

#### СоздатьИБИзФайлаВыгрузки

```bsl
// Создать информационную базу из файла выгрузки.
// Для команды автоматом устанавливаются параметры "--create-database" и "--force"
// Параметр "--apply" не устанавливается, предполагается использование отдельной команды
// Параметры:
//  ПутьКФайлувыгрузки - Строка - Путь к файлу выгрузки информационной базы
//  Локаль - Строка - имя локали 
//  СмещениеДат - Число - Смещение дат в годах (имеет смысл только для MSSQL)
```

#### СоздатьИБИзФайлаКонфигурации

```bsl
// Создать информационную базу из файла конфигурации.
// Для команды автоматом устанавливаются параметры "--create-database" и "--force"
// Параметр "--apply" не устанавливается, предполагается использование отдельной команды
// Параметры:
//  ПутьКФайлуКонфигурации - Строка - Путь к файлу конфигурации информационной базы
//  Локаль - Строка - имя локали 
//  СмещениеДат - Число - Смещение дат в годах (имеет смысл только для MSSQL)
```

#### СоздатьИБИзФайловКонфигурации

```bsl
// Создать информационную базу из файлов конфигурации.
// Для команды автоматом устанавливаются параметры "--create-database" и "--force"
// Параметр "--apply" не устанавливается, предполагается использование отдельной команды
// Параметры:
//  ПутьККаталогуВыгрузки - Строка - Путь к каталогу выгрузки конфигурации в файлы
//  Локаль - Строка - имя локали 
//  СмещениеДат - Число - Смещение дат в годах (имеет смысл только для MSSQL)
```

#### ВыгрузитьДанныеИБ

```bsl
// Выгрузить данные из информационной базы
// Параметры:
//  ПутьКФайлуВыгрузки - Строка - Путь к файлу выгрузки
```

#### ЗагрузитьДанныеИБ

```bsl
// Загрузить данные из файла выгрузки
// Автоматом добавляется параметр "--create-database"
// Параметры:
//  ПутьКФайлуВыгрузки - Строка - Путь к файлу выгрузки
```

#### ЗагрузитьКонфигурацию

```bsl
// Загрузить конфигурацию из файла
// Параметры:
//  ПутьКФайлуКонфигурации - Строка - Путь к файлу конфигурации
//  ИмяРасширения -Строка - Имя расширения. Если не заполнено, то будет загружена
//      основная конфигурация
```

#### ВыгрузитьКонфигурациюВФайл

```bsl
// Выгрузить конфигурацию базы данных в файл
// Параметры:
//  ПутьКФайлуКонфигурации - Строка - Путь к файлу конфигурации
//  ИмяРасширения - Строка - Имя расширения. Если не заполнено, то будет выгружена
//      конфигурация БД или основная конфигурация (см. следующий параметр)
//  ВыгружатьОсновнуюКонфигурацию - Булево - Если Истина, то будет выгружена основная
//      конфигурация
```

#### ПроверитьКонфигурацию

```bsl
// Проверить конфигурацию
// Параметры:
//  ИмяРасширения - Строка - имя расширения
// Возвращаемое значение:
//  - Строка - строка консольного вывода команды
```

#### ОбновитьКонфигурациюБазыДанных

```bsl
// Обновить конфигурацию
// Параметры:
//  ИмяРасширения - Строка - имя расширения
```

#### ВозвратитьсяККонфигурацииБазыДанных

```bsl
// Возвратиться к конфигурации базы данных
// Параметры:
//  ИмяРасширения - Строка - имя расширения
```

#### ВыгрузитьВФайлСостояниеКонфигурации

```bsl
// Вывести информацию о состоянии конфигурации (ConfigDumpInfo)
// Параметры:
//  ПутьКФайлуXML - Строка - Путь к файлу состояния конфигурации (ConfigDumpInfo)
//  ИмяРасширения - Строка - Имя расширения
```

#### ВыгрузитьВФайлИзмененияКонфигурации

```bsl
// Вывести информацию о изменениях конфигурации относительно переданного состояния (ConfigDumpInfo)
// Параметры:
//  ПутьКФайлуXMLИзменений - Строка - Путь к файлу для записи информации о изменениях в конфигурации
//  ПутьКФайлуXMLВыгрузки - Строка - Путь к файлу информации о конфигурации
//                           (ConfigDumpInfo) относительно которого вычисляются изменения текущей конфигурации
//  ИмяРасширения - Строка - Имя расширения
//  ВыводитьВКраткомФормате - Булево - Отображать информацию о изменениях в сокращенном виде
```

#### ВыгрузитьОбъектыКонфигурацииВФайлы

```bsl
// Экспорт выбранных объектов конфигурации в XML
// Параметры:
//  КаталогВыгрузки - Строка - Каталог для экспорта 
//  ВыгружатьРекурсивно - Булево - Выполнять экспорт дочерних объектов.
//  Объекты - Массив - Список строк - имен объектов конфигурации для экспорта.
//  ИмяРасширения - Строка - Имя расширения
```

#### ВыгрузитьВсеРасширенияВФайлы

```bsl
// Выгрузить все расширения в файлы
// Параметры:
//  КаталогВыгрузки - Строка - Каталог выгрузки расширений в файлы
```

#### ВыгрузитьКонфигурациюВФайлы

```bsl
// Экспорт конфигурации в файлы
// Параметры:
//  КаталогВыгрузки -Строка - Каталог для выгрузки конфигурации в файлы
//  ПутьКФайлуXMLВыгрузки - Строка - Путь к файлу информации о конфигурации
//        (ConfigDumpInfo) относительно которого вычисляются изменения текущей конфигурации
//  ИмяРасширения - Строка - Имя расширения
//  Синхронизировать - Булево - Синхронизировать имеющийся экспорт с конфигурацией
```

#### ЗагрузитьКонфигурациюИзФайлов

```bsl
// Загружает основную конфигурацию или расширение из файлов
// Параметры:
//  КаталогВыгрузки - Строка - Имя корневого каталога с ранее выгруженными файлами
//  ИмяРасширения - Строка - Имя расширения конфигурации. Если не заполнено, то загружать
//                           в основную конфигурацию
```

#### ЗагрузитьВыбранныеФайлыКонфигурации

```bsl
// Импорт выбранных файлов конфигурации из XML
// Параметры:
//  КаталогВыгрузки - Строка - каталог выгрузки файлов
//  ВыбранныеФайлы - Массив - список файлов для загрузки
//  ИмяРасширения - Строка - имя расширения
```

#### ЗагрузитьВсеРасширенияИзФайлов

```bsl
// Импорт всех расширений конфигурации из XML
// Параметры:
//  КаталогВыгрузки - строка - Каталог выгрузки расширений в файлы
```

#### Версия

```bsl
// Получить версию платформы 1С
// Возвращаемое значение:
//  Строка - Версия платформы 1С
```

### Класс КонфигурационныйФайлАС

#### ПараметрыСервера

```bsl
// Установка параметров автономного сервера
// Параметры:
//  Адрес - Строка - IP-адрес автономного сервера
//  Порт - Число - Имя порта автономного сервера
//  ИмяХоста - Строка - имя хоста (необязательный)
```

#### ПараметрыСервернойБД

```bsl
// Установка параметров серверной автономной базы
// Параметры:
//  ТипСУБД - Строка - тип СУБД
//  Сервер - Строка - имя сервера или IP-адрес
//  ИмяДБ - Строка - имя базы данных
//  ИмяПользователя - Строка - имя пользователя серверной базы данных
//  Пароль - Строка - пароль пользователя серверной базы данных
```

#### ПараметрыФайловойБД

```bsl
// Установка параметров файловой БД
// Параметры:
//  ПутьКФайлуИБ - Строка - Путь к файлу информационной базы.
//  ИмяПользователя - Строка - имя пользователя информационной базы
//  Пароль - Строка - пароль пользователя информационной базы
```

#### ПараметрыИБ

```bsl
// Установка параметров информационной базы
// Параметры:
//  ИмяИБ - Строка - имя информационной базы
//  ВыдаватьКлиентскиеЛицензии - Булево - разрешить выдавать клиентские лицензии автономному серверу
//  РазрешитьРегламентныеЗадания - Булево - разрешить выполнение регламентных заданий
//  ИД - Строка - уникальный идентификатор информационной базы. По умолчанию - значение unique, то есть
//       каждый раз при перезапуске будет генерироваться новый уникальный идентификатор. 
```

#### ПараметрыХТТП

```bsl
// Установка параметров веб-доступа к информационной базе.
// Параметры:
//  БазовыйУРЛ - Строка - Базовый путь доступа к информационной базе с помощью веб-сервера.
//        К одной информационной базе можно организовать несколько публикаций,
//        которые отличаются базовыми путями и другими параметрами публикации.
//      Значение по умолчанию:/.
```

#### ПараметрыВеб_Аутентификация

```bsl
// Установка параметров веб-аутентификации OpenId (секции rely и provider)
// Параметры:
//  УРИПровайдера - Строка - указывает URL информационной базы «1С:Предприятия», выступающей в роли OpenID-провайдера.
//  ВремяЖизни - Число - время жизни признака аутентифицированности идентификатора в секундах.
//        Значение по умолчанию - 86400 секунд.
//  МаскаРазрешенныхИмен - Строка - представляет собой регулярное выражение, которое определяет
//        маску разрешенных имен сайтов, на которые могут выполняться переадресации пользовательского
//        веб-браузера (параметр запроса openid.return_to) после исполнения команды OpenID-провайдера.
//  ПровайдерыOpenIDConnect - Строка - данный элемент содержит описание внешних OpenID-провайдеров,
//        поддерживающих протокол авторизации OpenID Connect v1.0 (http://openid.net/connect/).
//        Описание представляет собой массив объектов, каждый из которых описывает одного
//        OpenID-провайдера. Массив представлен в виде JSON-сериализации.
//        Подробнее см. https://its.1c.ru/db/v8314doc#bookmark:adm:TI000000847
//  РазрешитьАутентификацию1С - Булево -указывает возможность применения аутентификации «1С:Предприятия». 
```

#### ДобавитьПараметрыВеб_Разделители

```bsl
// Добавление параметров разделителя в массив параметров разделителей ИБ.
// Массив параметров разделителей содержит описание разделителей для базового
// каталога доступа. Если прикладное решение содержит несколько разделителей,
// данная секция может содержать несколько записей. Каждая запись описывает параметры
// одного разделителя в порядке их (разделителей) следования в метаданных.
// Параметры:
//  Значение - Строка - явное указание значения разделителя, который находится на этой позиции.
//  РазрешитьИзменение - Булево - Параметр управляет возможностью изменения значения
//       разделителя из кода прикладного решения.
//  ДобавлятьЗначениеВАдрес - Булево - определяет необходимость присутствия значения
//       данного разделителя в адресе публикуемой информационной базы
//  ЭтоПервоеЗначениеРазделителя - Булево - флаг для инициализации массива параметров.
```

#### ПараметрыВеб_Приложение

```bsl
// Установка параметров публикации управляемого приложения (application)
// Параметры:
//  УРИВозврата - Строка - адрес (URL), по которому будет выполнен переход после завершения работы веб-клиента.
//  Публиковать - Булево - Определяет возможность использовать клиентское приложение для доступа 
//        к информационной базе.
```

#### ПараметрыВеб_ПубликацияOData

```bsl
// Установка параметров публикации интерфейса OData
// Параметры:
//  Публиковать - Булево - Управляет доступностью стандартного интерфейса OData через указанную публикацию.
//  ПараметрыРежимаПовторногоИспользованияСеансов - Соответствие - параметры режима повторного
//        использования сеансов (см. описание следующего метода).
```

#### ПараметрыВеб_РежимПовторногоИспользованияСеансов

```bsl
// Устанавливает параметры повторного использования сеансов
// Параметры:
//  Режим - Строка - AutoUse, DontUse, Use
//  ВремяБездействия - Число -Время бездействия сеанса, после которого он завершается принудительно (в секундах).
//  МаксимальноеКоличествоСеансов - Число - Максимальное количество сеансов, которые могут быть созданы при
//        автоматическом управлении сеансами. 
//  ТаймаутОжиданияСвободногоСеанса - Число - Время ожидания появления свободного сеанса после заполнения
//        пула сеансов (в секундах).
```

#### ПараметрыВебСервисовОбщие

```bsl
// Устанавливает параметры доступа к Web-сервисам, которые реализованы в прикладном решении.
// Параметры:
//  ПубликоватьВебСервисы - Булево - определяет доступность Web-сервисов приложения
//  ПубликоватьВебСервисыРасширений - Булево - определяет доступность Web-сервисов расширений приложения
```

#### ДобавитьПараметрыВебСервиса

```bsl
// Добавление в массив параметров отдельного web-сервиса
// Параметры:
//  Публиковать - Булево - необходимость публикации сервиса
//  Имя - Строка - имя сервисв
//  Синоним - Строка - точка подключения сервиса
//  ПараметрыПовторногоИспользования - Строка - параметры режима
//      повторного использования сеансов. Если параметр пропущен, то
//      это эквивалентно следующим значениям, установленным по умолчанию:
//      mode: AutoUse
//      max-age: 20s
//      pool-size: 10
//      pool-timeout: 5s
//      Подробности: https://its.1c.ru/db/v8314doc#bookmark:adm:TI000000940
//  ЭтоПервыйСервис - Булево - флаг для инициализации массива web-сервисов 
```

#### ПараметрыХТТПСервисовОбщие

```bsl
// Устанавливает параметры доступа к http-сервисам, которые реализованы в прикладном решении.
// Параметры:
//  ПубликоватьХТТПСервисы - Булево - определяет доступность http-сервисов приложения
//  ПубликоватьХТТПСервисыРасширений - Булево - определяет доступность http-сервисов расширений приложения
```

#### ДобавитьПараметрыХТТПСервиса

```bsl
// Добавление в массив параметров отдельного http-сервиса
// Параметры:
//  Публиковать - Булево - необходимость публикации сервиса
//  Имя - Строка - имя сервисв
//  КорневойУРЛ - Строка - точка подключения сервиса
//  ПараметрыПовторногоИспользования - Строка - параметры режима
//      повторного использования сеансов. Если параметр пропущен, то
//      это эквивалентно следующим значениям, установленным по умолчанию:
//      mode: AutoUse
//      max-age: 20s
//      pool-size: 10
//      pool-timeout: 5s
//      Подробности: https://its.1c.ru/db/v8314doc#bookmark:adm:TI000000940
//  ЭтоПервыйСервис - Булево - флаг для инициализации массива http-сервисов 
```

#### ПараметрыПубликацииДистрибутивов

```bsl
// Устанавливает параметры публикации клиентских дистрибутивов (pubdst)
// Параметры:
//  ПутьКФайлуВин32 - Строка - Полное имя файла с архивом дистрибутива
//        32-разрядного клиентского приложения для ОС Windows. 
//  ПутьКФайлуВин64 - Строка - Полное имя файла с архивом дистрибутива
//        64-разрядного клиентского приложения для ОС Windows.
//  ПутьКФайлуМак64 - Строка - Полное имя файла с архивом дистрибутива
//        64-разрядного клиентского приложения для ОС macOS.
```

#### СоздатьКонфигурационныйФайл

```bsl
// Создание конфигурационного файла по ранее заполненным параметрам
// Параметры:
//  ПутьКФайлу - Строка - полный путь к конфигурационному файлу
```